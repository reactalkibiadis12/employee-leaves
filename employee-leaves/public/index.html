<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Διαχείριση Αδειών Εργαζομένων</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f4f7fa;
            color: #333;
            padding: 20px;
            line-height: 1.6;
        }

        h1, h2, h3 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .container {
            width: 100%;
            padding: 20px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 20px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .login-container input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .login-container button, .logout-btn {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor:，其他pointer;
            transition: background-color 0.3s;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .login-container button:hover, .logout-btn:hover {
            background-color: #2980b9;
        }

        .dropdown {
            margin-bottom: 20px;
        }

        .dropdown button, .form-container button, .edit-form button, .details button {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
        }

        .dropdown button:hover, .form-container button:hover, .edit-form button:hover, .details button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .employee-search {
            margin-bottom: 15px;
        }

        .employee-search input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
            transition: border-color 0.3s;
        }

        .employee-search input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }

        .employee-dropdown {
            position: relative;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .employee-dropdown select {
            flex: 1;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
            cursor: pointer;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="gray" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 10px center;
            transition: border-color 0.3s;
        }

        .employee-dropdown select:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }

        .year-selector {
            margin-bottom: 15px;
        }

        .year-selector select {
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
        }

        .employee-actions {
            display: none;
            gap: 10px;
        }

        .employee-actions button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .employee-actions button.edit {
            background-color: #f39c12;
        }

        .employee-actions button.edit:hover {
            background-color: #e67e22;
        }

        .employee-actions button.delete {
            background-color: #e74c3c;
        }

        .employee-actions button.delete:hover {
            background-color: #c0392b;
        }

        .form-container, .edit-form {
            margin-bottom: 20px;
            display: none;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .form-container input, .edit-form input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-container input:focus, .edit-form input:focus {
            border-color: #3498db;
            outline: none;
        }

        .form-container .children-section, .edit-form .children-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .form-container .children-section select, .edit-form .children-section select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        #differentLevels, #editDifferentLevels {
            display: none;
        }

        .details {
            display: none;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: #fff;
            border-radius: 8px;
            overflow-x: auto;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
            white-space: nowrap;
        }

        th {
            background-color: #3498db;
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f1f1f1;
        }

        .leave-actions button {
            padding: 8px 12px;
            margin: 0 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .leave-actions button:first-child {
            background-color: #2ecc71;
        }

        .leave-actions button:first-child:hover {
            background-color: #27ae60;
        }

        .leave-actions button:last-child {
            background-color: #e74c3c;
        }

        .leave-actions button:last-child:hover {
            background-color: #c0392b;
        }

        .summary label {
            font-weight: 500;
            margin: 5px 0;
            display: block;
        }

        .summary input[type="number"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100px;
        }

        .report {
            margin-top: 20px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .report p {
            margin: 5px 0;
        }

        .modern-button {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin: 5px;
        }

        .modern-button.add-leave {
            background: linear-gradient(45deg, #ff6f61, #ff9f80);
        }

        .modern-button.add-leave:hover {
            background: linear-gradient(45deg, #ff9f80, #ff6f61);
            transform: translateY(-2px);
        }

        .modern-button.print-leaves {
            background: linear-gradient(45deg, #40c4ff, #0288d1);
        }

        .modern-button.print-leaves:hover {
            background: linear-gradient(45deg, #0288d1, #40c4ff);
            transform: translateY(-2px);
        }

        .modern-button.generate-report {
            background: linear-gradient(45deg, #66bb6a, #388e3c);
        }

        .modern-button.generate-report:hover {
            background: linear-gradient(45deg, #388e3c, #66bb6a);
            transform: translateY(-2px);
        }

        .parental-hours-input {
            display: none;
            width: 60px;
            padding: 5px;
            margin-left: 5px;
        }

        .reason-input {
            width: 100%;
            padding: 5px;
        }

        .holiday-warning {
            color: red;
            font-size: 12px;
            display: none;
            margin-top: 2px;
        }

        .flatpickr-day.holiday {
            background: #ff3333;
            color: white;
            border-radius: 50%;
        }

        .flatpickr-day.holiday:hover {
            background: #e60000;
        }

        .cancel-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 5px;
        }

        .cancel-btn:hover {
            background-color: #c0392b;
        }

        @media print {
            body {
                visibility: hidden;
            }
            .print-header, .print-header *, #leaveTable, #leaveTable * {
                visibility: visible;
            }
            .print-header {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
            }
            #leaveTable {
                position: absolute;
                top: 100px;
                left: 0;
                width: 100%;
            }
            @page {
                size: landscape;
            }
            body {
                transform: scale(0.8);
                transform-origin: 0 0;
                width: 125%;
            }
        }
    </style>
</head>
<body>
    <div id="loginContainer" class="login-container">
        <h2>Σύνδεση Διαχειριστή</h2>
        <input type="email" id="loginEmail" placeholder="Email">
        <input type="password" id="loginPassword" placeholder="Κωδικός">
        <button onclick="login()">Σύνδεση</button>
        <p id="loginError" style="color: red; display: none;"></p>
    </div>

    <div id="mainContainer" class="container" style="display: none;">
        <button class="logout-btn" onclick="logout()">Αποσύνδεση</button>
        <h1>Διαχείριση Αδειών Εργαζομένων</h1>
        <div class="dropdown">
            <button onclick="toggleForm()">Προσθήκη Εργαζομένου ▼</button>
        </div>
        <div class="form-container" id="addEmployeeForm">
            <h3>Προσθήκη Νέου Εργαζομένου</h3>
            <input type="text" id="surname" placeholder="Επώνυμο"><br>
            <input type="text" id="name" placeholder="Όνομα"><br>
            <input type="text" id="afm" placeholder="ΑΦΜ"><br>
            <input type="email" id="email" placeholder="Email"><br>
            <div class="children-section">
                <input type="number" id="numberOfChildren" placeholder="Αριθμός Παιδιών" min="0" oninput="toggleDifferentLevels()">
                <div id="differentLevels">
                    <label>Διαφορετικές Εκπαιδευτικές Βαθμίδες:</label>
                    <select id="differentLevelsSelect">
                        <option value="false">ΟΧΙ</option>
                        <option value="true">ΝΑΙ</option>
                    </select>
                </div>
            </div>
            <button onclick="addEmployee()">Προσθήκη</button>
        </div>

        <div class="employee-search">
            <input type="text" id="employeeSearch" placeholder="Αναζήτηση Εργαζομένου (Επώνυμο ή Όνομα)" onkeyup="filterEmployees()">
        </div>

        <div class="employee-dropdown" id="employeeDropdown">
            <select id="employeeSelect" onchange="showDetails(this.value)">
                <option value="">Επιλέξτε Εργαζόμενο</option>
            </select>
            <div class="employee-actions" id="employeeActions">
                <button class="edit" onclick="editEmployee(selectedEmployee.id)">Επεξεργασία</button>
                <button class="delete" onclick="deleteEmployee(selectedEmployee.id)">Διαγραφή</button>
            </div>
        </div>

        <div class="edit-form" id="editForm">
            <h3>Επεξεργασία Εργαζομένου</h3>
            <input type="text" id="editSurname" placeholder="Επώνυμο"><br>
            <input type="text" id="editName" placeholder="Όνομα"><br>
            <input type="text" id="editAfm" placeholder="ΑΦΜ"><br>
            <input type="email" id="editEmail" placeholder="Email"><br>
            <div class="children-section">
                <input type="number" id="editNumberOfChildren" placeholder="Αριθμός Παιδιών" min="0" oninput="toggleEditDifferentLevels()">
                <div id="editDifferentLevels">
                    <label>Διαφορετικές Εκπαιδευτικές Βαθμίδες:</label>
                    <select id="editDifferentLevelsSelect">
                        <option value="false">ΟΧΙ</option>
                        <option value="true">ΝΑΙ</option>
                    </select>
                </div>
            </div>
            <button onclick="saveEdit()">Αποθήκευση</button>
            <button onclick="cancelEdit()">Ακύρωση</button>
        </div>

        <div class="details" id="employeeDetails">
            <h2 id="employeeName"></h2>
            <div class="summary">
                <label>Δικαιούται <span id="currentYearEntitled"></span>: <span id="entitled"></span></label>
                <label>Υπόλοιπα προηγούμενου έτους: <input type="number" id="previous" min="0" onchange="updateTotals()"></label>
                <label>Σύνολα <span id="currentYearTotal"></span>: <span id="total"></span></label>
                <label>Υπόλοιπα: <span id="remaining"></span></label>
                <label>Συνολικές ώρες γονικής άδειας: <span id="totalParentalHours"></span></label>
                <label>Υπόλοιπες ώρες γονικής άδειας: <span id="remainingParentalHours"></span></label>
                <label>Σύνολο Αιμοδοσίας: <span id="totalBloodDonationDays"></span></label>
                <label>Υπόλοιπα Αιμοδοσίας: <span id="remainingBloodDonationDays"></span></label>
                <label>Σύνολο Υ.Δ: <span id="totalSpecialDays"></span></label>
                <label>Υπόλοιπα Υ.Δ: <span id="remainingSpecialDays"></span></label>
            </div>
            <div class="year-selector">
                <label>Επιλογή Έτους: </label>
                <select id="yearSelect" onchange="updateLeaveTableForYear(this.value)">
                    <!-- Θα γεμίσει δυναμικά -->
                </select>
            </div>
            <div class="print-header">
                <h3 id="printEmployeeDetails"></h3>
            </div>
            <table id="leaveTable">
                <thead>
                    <tr>
                        <th>Α/Α</th><th>ΑΠΟ</th><th>ΕΩΣ</th><th>ΜΕΡΕΣ</th><th>ΚΑΝΟΝΙΚΗ</th><th>ΑΝΑΡ/ΚΗ</th><th>ΓΟΝΙΚΗ</th><th>ΕΚΠ/ΚΗ</th><th>Υ.Δ</th><th>ΑΙΜΟΔΟΣΙΑ</th><th>ΑΡΓΙΕΣ</th><th>ΡΕΠΟ</th><th>ΑΛΛΗ</th><th>ΑΙΤΙΟ                <th>ΑΙΤΙΟΛΟΓΙΑ</th><th>ΕΝΕΡΓΕΙΕΣ</th><th>ΥΠΑΛΛΗΛΟΣ</th><th>ΤΜΗΜΑΤΑΡΧΗΣ</th><th>ΠΡΟΪΣΤΑΜΕΝΟΣ</th>
                    </tr>
                </thead>
                <tbody id="leaveTableBody"></tbody>
            </table>
            <button class="modern-button add-leave" onclick="addLeaveRow()">Προσθήκη Άδειας</button>
            <button class="modern-button print-leaves" onclick="printLeaves()">Εκτύπωση Αδειών</button>
            <button class="modern-button generate-report" onclick="generateReport()">Δημιουργία Αναφοράς</button>
            <div class="report" id="leaveReport" style="display: none;">
                <h3>Αναφορά Αδειών <span id="reportYear"></span></h3>
                <p>Σύνολο Ημερών Αδειών: <span id="totalLeaveDays"></span></p>
                <p>Κανονική: <span id="regularDays"></span></p>
                <p>Αναρρωτική: <span id="sickDays"></span></p>
                <p>Γονική: <span id="parentalDays"></span> (Ώρες: <span id="parentalHours"></span>)</p>
                <p>Εκπαιδευτική: <span id="educationalDays"></span></p>
                <p>Υ.Δ: <span id="specialDays"></span></p>
                <p>Αιμοδοσία: <span id="bloodDonationDays"></span></p>
                <p>Ρεπό: <span id="dayOffDays"></span></p>
                <p>Άλλη: <span id="otherDays"></span></p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/el.js"></script>
    <script>
        const supabaseUrl = "https://nsrksmlqruogmckxpqer.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zcmtzbWxxcnVvZ21ja3hwcWVyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE3NjYwNjQsImV4cCI6MjA1NzM0MjA2NH0.NydawPjtyBG83qH79uY6rWqCFZleJ6zfo-ZgkRw5QoY";
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        let selectedEmployee = null;
        let leaves = [];
        let editingEmployee = null;
        let allEmployees = [];
        let currentYear = new Date().getFullYear();
        let selectedYear = currentYear;
        const adminEmail = "themspyr@gmail.com";
        let greekHolidays = {};

        const TOTAL_BLOOD_DONATION_DAYS = 6;
        const TOTAL_SPECIAL_DAYS = 2;
        const DEFAULT_ENTITLED_DAYS = 25;

        async function checkAuth() {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                const user = session.user;
                if (user.email === adminEmail) {
                    document.getElementById("loginContainer").style.display = "none";
                    document.getElementById("mainContainer").style.display = "block";
                    await checkAndUpdateYear();
                    loadEmployees();
                } else {
                    alert("Μόνο ο διαχειριστής μπορεί να έχει πρόσβαση!");
                    logout();
                }
            } else {
                document.getElementById("loginContainer").style.display = "block";
                document.getElementById("mainContainer").style.display = "none";
            }
        }

        async function checkAndUpdateYear() {
            const storedYear = localStorage.getItem("lastCheckedYear");
            const newYear = new Date().getFullYear();

            if (storedYear && parseInt(storedYear) !== newYear) {
                const { data: employees, error: empError } = await supabase.from("employees").select("*");
                if (empError) {
                    console.error("Error fetching employees for year update:", empError);
                    return;
                }

                for (const emp of employees) {
                    const { error: updateError } = await supabase
                        .from("employees")
                        .update({
                            previous: emp.remaining,
                            entitled: DEFAULT_ENTITLED_DAYS,
                            total: DEFAULT_ENTITLED_DAYS + emp.remaining,
                            remaining: DEFAULT_ENTITLED_DAYS + emp.remaining
                        })
                        .eq("id", emp.id);

                    if (updateError) {
                        console.error(`Error updating employee ${emp.id}:`, updateError);
                    }
                }

                localStorage.setItem("lastCheckedYear", newYear.toString());
                currentYear = newYear;
                selectedYear = newYear;
            } else if (!storedYear) {
                localStorage.setItem("lastCheckedYear", currentYear.toString());
            }
        }

        async function login() {
            const email = document.getElementById("loginEmail").value;
            const password = document.getElementById("loginPassword").value;
            const errorMsg = document.getElementById("loginError");

            if (!email || !password) {
                errorMsg.textContent = "Παρακαλώ συμπληρώστε όλα τα πεδία!";
                errorMsg.style.display = "block";
                return;
            }

            const { error } = await supabase.auth.signInWithPassword({
                email: email,
                password: password,
            });

            if (error) {
                errorMsg.textContent = "Λάθος email ή κωδικός!";
                errorMsg.style.display = "block";
                return;
            }

            if (email !== adminEmail) {
                errorMsg.textContent = "Μόνο ο διαχειριστής μπορεί να συνδεθεί!";
                errorMsg.style.display = "block";
                await supabase.auth.signOut();
                return;
            }

            document.getElementById("loginContainer").style.display = "none";
            document.getElementById("mainContainer").style.display = "block";
            await checkAndUpdateYear();
            loadEmployees();
        }

        async function logout() {
            await supabase.auth.signOut();
            document.getElementById("loginContainer").style.display = "block";
            document.getElementById("mainContainer").style.display = "none";
            document.getElementById("loginEmail").value = "";
            document.getElementById("loginPassword").value = "";
            document.getElementById("loginError").style.display = "none";
        }

        checkAuth();

        function formatDate(dateStr) {
            if (!dateStr) return "";
            const date = new Date(dateStr);
            return `${date.getDate().toString().padStart(2, "0")}/${(date.getMonth() + 1).toString().padStart(2, "0")}/${date.getFullYear()}`;
        }

        function toggleForm() {
            const form = document.getElementById("addEmployeeForm");
            form.style.display = form.style.display === "block" ? "none" : "block";
        }

        function toggleDifferentLevels() {
            const numChildren = parseInt(document.getElementById("numberOfChildren").value) || 0;
            const differentLevels = document.getElementById("differentLevels");
            differentLevels.style.display = numChildren >= 2 ? "block" : "none";
            if (numChildren < 2) {
                document.getElementById("differentLevelsSelect").value = "false";
            }
        }

        function toggleEditDifferentLevels() {
            const numChildren = parseInt(document.getElementById("editNumberOfChildren").value) || 0;
            const differentLevels = document.getElementById("editDifferentLevels");
            differentLevels.style.display = numChildren >= 2 ? "block" : "none";
            if (numChildren < 2) {
                document.getElementById("editDifferentLevelsSelect").value = "false";
            }
        }

        async function loadEmployees() {
            const { data, error } = await supabase.from("employees").select("*");
            if (error) {
                console.error("Error loading employees:", error);
                return;
            }
            allEmployees = data;
            renderEmployees(data);
        }

        function renderEmployees(employees) {
            const dropdown = document.querySelector("#employeeSelect");
            dropdown.innerHTML = '<option value="">Επιλέξτε Εργαζόμενο</option>';
            employees.forEach((emp) => {
                const option = document.createElement("option");
                option.value = emp.id;
                option.textContent = `${emp.surname} ${emp.name} | ${emp.afm} | ${emp.email}`;
                dropdown.appendChild(option);
            });
        }

        function filterEmployees() {
            const searchTerm = document.getElementById("employeeSearch").value.toLowerCase();
            const filteredEmployees = allEmployees.filter(emp =>
                emp.surname.toLowerCase().includes(searchTerm) ||
                emp.name.toLowerCase().includes(searchTerm)
            );
            renderEmployees(filteredEmployees);
        }

        async function addEmployee() {
            const surname = document.getElementById("surname").value;
            const name = document.getElementById("name").value;
            const afm = document.getElementById("afm").value;
            const email = document.getElementById("email").value;
            const numberOfChildren = parseInt(document.getElementById("numberOfChildren").value) || 0;
            const differentLevels = document.getElementById("differentLevelsSelect").value === "true";

            if (surname && name && afm && email) {
                const { error } = await supabase.from("employees").insert({
                    surname,
                    name,
                    afm,
                    email,
                    previous: 0,
                    entitled: DEFAULT_ENTITLED_DAYS,
                    total: DEFAULT_ENTITLED_DAYS,
                    remaining: DEFAULT_ENTITLED_DAYS,
                    number_of_children: numberOfChildren,
                    different_educational_levels: differentLevels
                });
                if (error) {
                    console.error("Error adding employee:", error);
                    return;
                }
                loadEmployees();
                document.getElementById("surname").value = "";
                document.getElementById("name").value = "";
                document.getElementById("afm").value = "";
                document.getElementById("email").value = "";
                document.getElementById("numberOfChildren").value = "";
                document.getElementById("differentLevelsSelect").value = "false";
                toggleDifferentLevels();
                toggleForm();
            } else {
                alert("Συμπληρώστε όλα τα πεδία!");
            }
        }

        async function deleteEmployee(id) {
            if (confirm("Είστε σίγουροι ότι θέλετε να διαγράψετε αυτόν τον εργαζόμενο;")) {
                const { error: leavesError } = await supabase
                    .from("leaves")
                    .delete()
                    .eq("employee_id", id);
                if (leavesError) {
                    console.error("Error deleting leaves:", leavesError);
                    return;
                }
                const { error } = await supabase
                    .from("employees")
                    .delete()
                    .eq("id", id);
                if (error) {
                    console.error("Error deleting employee:", error);
                    return;
                }
                loadEmployees();
                document.getElementById("employeeSelect").value = "";
                document.getElementById("employeeActions").style.display = "none";
                if (selectedEmployee && selectedEmployee.id === id) {
                    document.getElementById("employeeDetails").style.display = "none";
                    selectedEmployee = null;
                }
                if (editingEmployee && editingEmployee.id === id) {
                    document.getElementById("editForm").style.display = "none";
                    editingEmployee = null;
                }
            }
        }

        async function editEmployee(id) {
            const { data, error } = await supabase
                .from("employees")
                .select("*")
                .eq("id", id)
                .single();
            if (error) {
                console.error("Error fetching employee for edit:", error);
                return;
            }
            editingEmployee = data;
            document.getElementById("editSurname").value = data.surname;
            document.getElementById("editName").value = data.name;
            document.getElementById("editAfm").value = data.afm;
            document.getElementById("editEmail").value = data.email;
            document.getElementById("editNumberOfChildren").value = data.number_of_children || 0;
            document.getElementById("editDifferentLevelsSelect").value = data.different_educational_levels ? "true" : "false";
            toggleEditDifferentLevels();
            document.getElementById("editForm").style.display = "block";
            document.getElementById("employeeDropdown").style.display = "none";
        }

        async function saveEdit() {
            const surname = document.getElementById("editSurname").value;
            const name = document.getElementById("editName").value;
            const afm = document.getElementById("editAfm").value;
            const email = document.getElementById("editEmail").value;
            const numberOfChildren = parseInt(document.getElementById("editNumberOfChildren").value) || 0;
            const differentLevels = document.getElementById("editDifferentLevelsSelect").value === "true";

            if (surname && name && afm && email) {
                const { error } = await supabase
                    .from("employees")
                    .update({
                        surname,
                        name,
                        afm,
                        email,
                        number_of_children: numberOfChildren,
                        different_educational_levels: differentLevels
                    })
                    .eq("id", editingEmployee.id);
                if (error) {
                    console.error("Error updating employee:", error);
                    return;
                }
                loadEmployees();
                document.getElementById("editForm").style.display = "none";
                document.getElementById("employeeDropdown").style.display = "flex";
                if (selectedEmployee && selectedEmployee.id === editingEmployee.id) {
                    selectedEmployee = { ...selectedEmployee, surname, name, afm, email, number_of_children: numberOfChildren, different_educational_levels: differentLevels };
                    document.getElementById("employeeName").textContent = `${surname} ${name}`;
                    document.getElementById("employeeSelect").value = editingEmployee.id;
                    updateTotals();
                }
                editingEmployee = null;
            } else {
                alert("Συμπληρώστε όλα τα πεδία!");
            }
        }

        function cancelEdit() {
            document.getElementById("editForm").style.display = "none";
            document.getElementById("employeeDropdown").style.display = "flex";
            editingEmployee = null;
        }

        function calculateTotalParentalHours(employee) {
            const numChildren = employee.number_of_children || 0;
            const differentLevels = employee.different_educational_levels || false;

            if (numChildren === 1) return 32;
            if (numChildren >= 2 && !differentLevels) return 40;
            if (numChildren >= 2 && differentLevels) return 48;
            return 0;
        }

        async function showDetails(id) {
            const actions = document.getElementById("employeeActions");
            if (!id) {
                document.getElementById("employeeDetails").style.display = "none";
                actions.style.display = "none";
                selectedEmployee = null;
                return;
            }
            const { data, error } = await supabase
                .from("employees")
                .select("*")
                .eq("id", id)
                .single();
            if (error) {
                console.error("Error loading employee details:", error);
                return;
            }
            selectedEmployee = data;
            document.getElementById("employeeDetails").style.display = "block";
            actions.style.display = "flex";
            document.getElementById("employeeName").textContent = `${data.surname} ${data.name}`;
            document.getElementById("printEmployeeDetails").textContent = `Εργαζόμενος: ${data.surname} ${data.name} | ΑΦΜ: ${data.afm} | Email: ${data.email}`;
            document.getElementById("previous").value = data.previous || 0;
            document.getElementById("entitled").textContent = data.entitled;
            document.getElementById("total").textContent = data.total;
            document.getElementById("remaining").textContent = data.remaining;
            document.getElementById("currentYearEntitled").textContent = currentYear;
            document.getElementById("currentYearTotal").textContent = currentYear;

            const totalParentalHours = calculateTotalParentalHours(data);
            document.getElementById("totalParentalHours").textContent = totalParentalHours;
            document.getElementById("totalBloodDonationDays").textContent = TOTAL_BLOOD_DONATION_DAYS;
            document.getElementById("totalSpecialDays").textContent = TOTAL_SPECIAL_DAYS;

            const { data: leavesData, error: leavesError } = await supabase
                .from("leaves")
                .select("*")
                .eq("employee_id", data.id);
            if (leavesError) {
                console.error("Error loading leaves:", leavesError);
                return;
            }
            leaves = leavesData.map(leave => ({ ...leave, saved: true }));
            console.log("Loaded leaves:", leaves);

            const years = [...new Set(leaves.map(leave => new Date(leave.from_date).getFullYear()))];
            const currentYearNow = new Date().getFullYear();
            if (!years.includes(currentYearNow)) years.push(currentYearNow);
            if (!years.includes(currentYearNow + 1)) years.push(currentYearNow + 1);
            years.sort((a, b) => b - a);

            for (const year of years) {
                if (!greekHolidays[year]) {
                    greekHolidays[year] = await getGreekHolidays(year);
                }
            }

            const yearSelect = document.getElementById("yearSelect");
            yearSelect.innerHTML = "";
            years.forEach(year => {
                const option = document.createElement("option");
                option.value = year;
                option.textContent = year;
                if (year === currentYear) option.selected = true;
                yearSelect.appendChild(option);
            });

            selectedYear = currentYear;
            updateLeaveTableForYear(selectedYear);
            updateTotals();
        }

        function updateLeaveTableForYear(year) {
            selectedYear = parseInt(year);
            renderLeaveTable();
            updateTotals();
            const addLeaveButton = document.querySelector(".add-leave");
            addLeaveButton.disabled = selectedYear !== currentYear;
        }

        async function getGreekHolidays(year) {
            const response = await fetch(`https://date.nager.at/api/v3/PublicHolidays/${year}/GR`);
            const holidays = await response.json();
            console.log(`Holidays for ${year}:`, holidays.map(h => h.date));
            return holidays.map(h => h.date);
        }

        function addLeaveRow() {
            if (selectedYear !== currentYear) {
                alert("Μπορείτε να προσθέσετε άδειες μόνο για το τρέχον έτος!");
                return;
            }
            const tbody = document.getElementById("leaveTableBody");
            const rowIndex = leaves.filter(leave => new Date(leave.from_date).getFullYear() === selectedYear).length;
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${rowIndex + 1}</td>
                <td><input type="text" class="flatpickr" id="fromDate${rowIndex}" onchange="calculateDays(this, ${rowIndex})"><span class="holiday-warning" id="rangeHolidayWarning${rowIndex}"></span></td>
                <td><input type="text" class="flatpickr" id="toDate${rowIndex}" onchange="calculateDays(this, ${rowIndex})"></td>
                <td><span class="days">0</span></td>
                <td><input type="radio" name="leave${rowIndex}" value="regular" onchange="updateLeave(${rowIndex})"></td>
                <td><input type="radio" name="leave${rowIndex}" value="sick" onchange="updateLeave(${rowIndex})"></td>
                <td><input type="radio" name="leave${rowIndex}" value="parental" onchange="updateLeave(${rowIndex})"><input type="number" class="parental-hours-input" id="parentalHours${rowIndex}" placeholder="Ώρες" min="0"></td>
                <td><input type="radio" name="leave${rowIndex}" value="educational" onchange="updateLeave(${rowIndex})"></td>
                <td><input type="radio" name="leave${rowIndex}" value="special" onchange="updateLeave(${rowIndex})"></td>
                <td><input type="radio" name="leave${rowIndex}" value="blood_donation" onchange="updateLeave(${rowIndex})"></td>
                <td><span class="holidays">0</span></td>
                <td><input type="radio" name="leave${rowIndex}" value="day_off" onchange="updateLeave(${rowIndex})"></td>
                <td><input type="radio" name="leave${rowIndex}" value="other" onchange="updateLeave(${rowIndex})"></td>
                <td><input type="text" class="reason-input" id="reason${rowIndex}" placeholder="Αιτιολογία (προαιρετικό)"></td>
                <td class="leave-actions">
                    <button class="cancel-btn" onclick="cancelLeaveRow(${rowIndex})">X</button>
                    <button onclick="saveLeave(${rowIndex})">Αποθήκευση</button>
                </td>
                <td></td><td></td><td></td>
            `;
            tbody.appendChild(row);
            leaves.push({
                employee_id: selectedEmployee.id,
                from_date: "",
                to_date: "",
                days: 0,
                holidays: 0,
                type: "",
                parental_hours: 0,
                blood_donation_days: 0,
                special_days: 0,
                reason: "",
                saved: false
            });

            flatpickr(`#fromDate${rowIndex}`, {
                dateFormat: "Y-m-d",
                locale: "el",
                disable: [],
                onDayCreate: function(dObj, dStr, fp, dayElem) {
                    const date = dayElem.dateObj;
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, "0");
                    const day = String(date.getDate()).padStart(2, "0");
                    const dateStr = `${year}-${month}-${day}`;
                    if (greekHolidays[year] && greekHolidays[year].includes(dateStr)) {
                        dayElem.classList.add("holiday");
                    }
                },
                onChange: function(selectedDates, dateStr, instance) {
                    calculateDays(instance.element, rowIndex);
                }
            });

            flatpickr(`#toDate${rowIndex}`, {
                dateFormat: "Y-m-d",
                locale: "el",
                disable: [],
                onDayCreate: function(dObj, dStr, fp, dayElem) {
                    const date = dayElem.dateObj;
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, "0");
                    const day = String(date.getDate()).padStart(2, "0");
                    const dateStr = `${year}-${month}-${day}`;
                    if (greekHolidays[year] && greekHolidays[year].includes(dateStr)) {
                        dayElem.classList.add("holiday");
                    }
                },
                onChange: function(selectedDates, dateStr, instance) {
                    calculateDays(instance.element, rowIndex);
                }
            });
        }

        function cancelLeaveRow(index) {
            leaves.splice(index, 1);
            renderLeaveTable();
        }

        async function calculateDays(input, index) {
            const row = input.parentElement.parentElement;
            const fromInput = row.cells[1].querySelector("input");
            const toInput = row.cells[2].querySelector("input");
            const from = fromInput.value;
            const to = toInput.value;
            const rangeWarning = document.getElementById(`rangeHolidayWarning${index}`);

            if (from && to) {
                const start = new Date(from);
                const end = new Date(to);
                const startYear = start.getFullYear();
                const endYear = end.getFullYear();

                if (startYear !== endYear) {
                    alert("Η ημερομηνία ΕΩΣ πρέπει να είναι στο ίδιο έτος με την ΑΠΟ!");
                    toInput.value = "";
                    leaves[index].to_date = "";
                    row.cells[3].querySelector(".days").textContent = "0";
                    row.cells[10].querySelector(".holidays").textContent = "0";
                    rangeWarning.style.display = "none";
                    return;
                }

                if (end < start) {
                    alert("Η ημερομηνία ΕΩΣ πρέπει να είναι ίδια ή μεταγενέστερη από την ΑΠΟ!");
                    toInput.value = from;
                    rangeWarning.style.display = "none";
                    return;
                }

                const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;

                const year = start.getFullYear();
                if (!greekHolidays[year]) {
                    greekHolidays[year] = await getGreekHolidays(year);
                }
                const holidays = greekHolidays[year];
                let holidayCount = 0;
                let current = new Date(start);
                while (current <= end) {
                    const dateStr = current.toISOString().split('T')[0];
                    if (holidays.includes(dateStr)) holidayCount++;
                    current.setDate(current.getDate() + 1);
                }

                rangeWarning.textContent = holidayCount > 0 ? "Το εύρος περιλαμβάνει αργίες" : "";
                rangeWarning.style.display = holidayCount > 0 ? "block" : "none";

                row.cells[3].querySelector(".days").textContent = days;
                row.cells[10].querySelector(".holidays").textContent = holidayCount;
                leaves[index].from_date = from;
                leaves[index].to_date = to;
                leaves[index].days = days;
                leaves[index].holidays = holidayCount;

                const parentalInput = row.cells[6].querySelector("input[type='radio']");
                const bloodDonationInput = row.cells[9].querySelector("input[type='radio']");
                const specialInput = row.cells[8].querySelector("input[type='radio']");

                parentalInput.disabled = days > 1;
                if (days > 1 && parentalInput.checked) {
                    parentalInput.checked = false;
                    leaves[index].type = "";
                }

                bloodDonationInput.disabled = days !== 2;
                if (days !== 2 && bloodDonationInput.checked) {
                    bloodDonationInput.checked = false;
                    leaves[index].type = "";
                }
            } else {
                rangeWarning.style.display = "none";
            }
        }

        function updateLeave(index) {
            const row = document.getElementById("leaveTableBody").rows[index];
            const selectedType = row.querySelector(`input[name="leave${index}"]:checked`);
            const parentalHoursInput = row.cells[6].querySelector(".parental-hours-input");

            leaves[index].type = selectedType ? selectedType.value : "";
            parentalHoursInput.style.display = leaves[index].type === "parental" ? "inline-block" : "none";
            if (leaves[index].type !== "parental") {
                parentalHoursInput.value = "";
                leaves[index].parental_hours = 0;
            }
        }

        async function saveLeave(index) {
            const leave = leaves[index];
            if (!leave.from_date || !leave.to_date) {
                alert("Παρακαλώ συμπληρώστε τις ημερομηνίες ΑΠΟ και ΕΩΣ!");
                return;
            }
            if (!leave.type) {
                alert("Παρακαλώ επιλέξτε έναν τύπο άδειας!");
                return;
            }

            const startDate = new Date(leave.from_date);
            const startYear = startDate.getFullYear();
            const reason = document.getElementById(`reason${index}`).value || null;
            const totalParentalHours = leave.type === "parental" ? (parseInt(document.getElementById(`parentalHours${index}`).value) || 0) : 0;

            if (leave.type === "special") {
                const totalSpecialDaysTaken = leaves
                    .filter(l => l.saved && l.special && new Date(l.from_date).getFullYear() === startYear)
                    .reduce((sum, l) => sum + l.days, 0);
                if (totalSpecialDaysTaken + leave.days > TOTAL_SPECIAL_DAYS) {
                    alert(`Ο εργαζόμενος έχει ξεπεράσει το όριο των ${TOTAL_SPECIAL_DAYS} ημερών Υ.Δ για το ${startYear}!`);
                    return;
                }
            }

            const leaveData = {
                employee_id: selectedEmployee.id,
                from_date: leave.from_date,
                to_date: leave.to_date,
                days: leave.days,
                holidays: leave.holidays,
                regular: leave.type === "regular",
                sick: leave.type === "sick",
                parental: leave.type === "parental",
                educational: leave.type === "educational",
                special: leave.type === "special",
                blood_donation: leave.type === "blood_donation",
                day_off: leave.type === "day_off",
                other: leave.type === "other",
                parental_hours: totalParentalHours,
                blood_donation_days: leave.type === "blood_donation" ? leave.days : 0,
                special_days: leave.type === "special" ? leave.days : 0,
                reason: reason
            };

            const { data, error } = await supabase.from("leaves").insert(leaveData).select();
            if (error) {
                console.error("Error saving leave:", error);
                alert("Σφάλμα κατά την αποθήκευση της άδειας: " + error.message);
                return;
            }
            leaves[index] = { ...data[0], saved: true };
            renderLeaveTable();
            await updateTotals();
        }

    async function deleteLeave(leaveId) {
    console.log("Attempting to delete leave with ID:", leaveId);

    // Βρίσκουμε τη θέση της άδειας στο array leaves
    const leaveIndex = leaves.findIndex(leave => leave.id === leaveId);
    let leave = leaveIndex !== -1 ? leaves[leaveIndex] : null;

    // Αν δεν βρεθεί στο leaves, κάνουμε fetch από τη βάση
    if (!leave) {
        const { data, error } = await supabase
            .from("leaves")
            .select("*")
            .eq("id", leaveId)
            .single();
        if (error || !data) {
            console.error("Error fetching leave from database or not found:", error);
            alert("Η άδεια δεν βρέθηκε στη βάση!");
            return;
        }
        leave = data;
        console.log("Leave fetched from database:", leave);
    }

    // Εμφάνιση παραθύρου επιβεβαίωσης
    if (!confirm("Είστε σίγουροι ότι θέλετε να διαγράψετε αυτήν την άδεια;")) {
        console.log("Deletion cancelled by user");
        return;
    }

    // Εκτέλεση διαγραφής
    console.log("Confirmed deletion for leave ID:", leaveId);
    try {
        const { error } = await supabase
            .from("leaves")
            .delete()
            .eq("id", leaveId);

        if (error) {
            console.error("Error deleting leave from database:", error);
            alert("Σφάλμα κατά τη διαγραφή της άδειας: " + error.message);
            return;
        }

        console.log("Leave deleted successfully from database:", leaveId);
        if (leaveIndex !== -1) leaves.splice(leaveIndex, 1);
        renderLeaveTable();
        await updateTotals();
    } catch (err) {
        console.error("Unexpected error during deletion:", err);
        alert("Προέκυψε απρόσμενο σφάλμα κατά τη διαγραφή!");
    }
}

        async function updateTotals() {
            const previous = parseInt(document.getElementById("previous").value) || 0;
            let regularDays = 0;
            let totalParentalHoursTaken = 0;
            let totalBloodDonationDaysTaken = 0;
            let totalSpecialDaysTaken = 0;

            leaves.forEach(leave => {
                const leaveYear = new Date(leave.from_date).getFullYear();
                if (leave.saved && leaveYear === currentYear) {
                    if (leave.regular) regularDays += leave.days;
                    if (leave.parental) totalParentalHoursTaken += leave.parental_hours || 0;
                    if (leave.blood_donation) totalBloodDonationDaysTaken += leave.blood_donation_days || 0;
                    if (leave.special) totalSpecialDaysTaken += leave.special_days || 0;
                }
            });

            const entitled = selectedEmployee.entitled;
            const total = entitled + previous;
            const remaining = total - regularDays;
            const totalParentalHours = calculateTotalParentalHours(selectedEmployee);
            const remainingParentalHours = totalParentalHours - totalParentalHoursTaken;
            const remainingBloodDonationDays = TOTAL_BLOOD_DONATION_DAYS - totalBloodDonationDaysTaken;
            const remainingSpecialDays = TOTAL_SPECIAL_DAYS - totalSpecialDaysTaken;

            document.getElementById("entitled").textContent = entitled;
            document.getElementById("total").textContent = total;
            document.getElementById("remaining").textContent = remaining;
            document.getElementById("totalParentalHours").textContent = totalParentalHours;
            document.getElementById("remainingParentalHours").textContent = remainingParentalHours;
            document.getElementById("totalBloodDonationDays").textContent = TOTAL_BLOOD_DONATION_DAYS;
            document.getElementById("remainingBloodDonationDays").textContent = remainingBloodDonationDays;
            document.getElementById("totalSpecialDays").textContent = TOTAL_SPECIAL_DAYS;
            document.getElementById("remainingSpecialDays").textContent = remainingSpecialDays;

            const { error } = await supabase
                .from("employees")
                .update({
                    previous: previous,
                    total: total,
                    remaining: remaining
                })
                .eq("id", selectedEmployee.id);
            if (error) {
                console.error("Error updating employee totals:", error);
            } else {
                selectedEmployee.previous = previous;
                selectedEmployee.total = total;
                selectedEmployee.remaining = remaining;
            }
        }

function renderLeaveTable() {
    const tbody = document.getElementById("leaveTableBody");
    tbody.innerHTML = "";
    const filteredLeaves = leaves.filter(leave => new Date(leave.from_date).getFullYear() === selectedYear);
    filteredLeaves.forEach(async (leave, index) => {
        const row = document.createElement("tr");

        const year = new Date(leave.from_date).getFullYear();
        if (!greekHolidays[year]) {
            greekHolidays[year] = await getGreekHolidays(year);
        }
        const holidays = greekHolidays[year];
        let holidayCount = 0;
        const start = new Date(leave.from_date);
        const end = new Date(leave.to_date);
        let current = new Date(start);
        while (current <= end) {
            const dateStr = current.toISOString().split('T')[0];
            if (holidays.includes(dateStr)) holidayCount++;
            current.setDate(current.getDate() + 1);
        }

        row.innerHTML = `
            <td>${index + 1}</td>
            <td><input type="text" class="flatpickr" id="fromDate${index}" value="${leave.from_date}" ${leave.saved ? 'disabled' : ''} onchange="calculateDays(this, ${index})"><span class="holiday-warning" id="rangeHolidayWarning${index}">${holidayCount > 0 ? "Το εύρος περιλαμβάνει αργίες" : ""}</span></td>
            <td><input type="text" class="flatpickr" id="toDate${index}" value="${leave.to_date}" ${leave.saved ? 'disabled' : ''} onchange="calculateDays(this, ${index})"></td>
            <td><span class="days">${leave.days}</span></td>
            <td><input type="radio" name="leave${index}" value="regular" ${leave.regular ? "checked" : ""} ${leave.saved ? 'disabled' : ''} onchange="updateLeave(${index})"></td>
            <td><input type="radio" name="leave${index}" value="sick" ${leave.sick ? "checked" : ""} ${leave.saved ? 'disabled' : ''} onchange="updateLeave(${index})"></td>
            <td><input type="radio" name="leave${index}" value="parental" ${leave.parental ? "checked" : ""} ${leave.saved ? 'disabled' : ''} ${leave.days > 1 ? 'disabled' : ''} onchange="updateLeave(${index})"><input type="number" class="parental-hours-input" id="parentalHours${index}" value="${leave.parental_hours || ''}" placeholder="Ώρες" min="0" ${leave.saved ? 'disabled' : ''} style="display: ${leave.parental ? 'inline-block' : 'none'};"></td>
            <td><input type="radio" name="leave${index}" value="educational" ${leave.educational ? "checked" : ""} ${leave.saved ? 'disabled' : ''} onchange="updateLeave(${index})"></td>
            <td><input type="radio" name="leave${index}" value="special" ${leave.special ? "checked" : ""} ${leave.saved ? 'disabled' : ''} onchange="updateLeave(${index})"></td>
            <td><input type="radio" name="leave${index}" value="blood_donation" ${leave.blood_donation ? "checked" : ""} ${leave.saved ? 'disabled' : ''} ${leave.days !== 2 ? 'disabled' : ''} onchange="updateLeave(${index})"></td>
            <td><span class="holidays">${leave.holidays || 0}</span></td>
            <td><input type="radio" name="leave${index}" value="day_off" ${leave.day_off ? "checked" : ""} ${leave.saved ? 'disabled' : ''} onchange="updateLeave(${index})"></td>
            <td><input type="radio" name="leave${index}" value="other" ${leave.other ? "checked" : ""} ${leave.saved ? 'disabled' : ''} onchange="updateLeave(${index})"></td>
            <td><input type="text" class="reason-input" id="reason${index}" value="${leave.reason || ''}" placeholder="Αιτιολογία (προαιρετικό)" ${leave.saved ? 'disabled' : ''}></td>
            <td class="leave-actions">
                ${!leave.saved ? `<button class="cancel-btn" onclick="cancelLeaveRow(${index})">X</button><button onclick="saveLeave(${index})">Αποθήκευση</button>` : `<button onclick="deleteLeave('${leave.id}')">Διαγραφή</button>`}
            </td>
            <td></td>
            <td></td>
            <td><img src="/signature.jpg" alt="Υπογραφή Προϊσταμένου" style="max-width: 100px; height: auto;"></td>
        `;
        tbody.appendChild(row);

        document.getElementById(`rangeHolidayWarning${index}`).style.display = holidayCount > 0 ? "block" : "none";

        if (!leave.saved) {
            flatpickr(`#fromDate${index}`, {
                dateFormat: "Y-m-d",
                locale: "el",
                disable: [],
                onDayCreate: function(dObj, dStr, fp, dayElem) {
                    const date = dayElem.dateObj;
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, "0");
                    const day = String(date.getDate()).padStart(2, "0");
                    const dateStr = `${year}-${month}-${day}`;
                    if (greekHolidays[year] && greekHolidays[year].includes(dateStr)) {
                        dayElem.classList.add("holiday");
                    }
                },
                onChange: function(selectedDates, dateStr, instance) {
                    calculateDays(instance.element, index);
                }
            });

            flatpickr(`#toDate${index}`, {
                dateFormat: "Y-m-d",
                locale: "el",
                disable: [],
                onDayCreate: function(dObj, dStr, fp, dayElem) {
                    const date = dayElem.dateObj;
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, "0");
                    const day = String(date.getDate()).padStart(2, "0");
                    const dateStr = `${year}-${month}-${day}`;
                    if (greekHolidays[year] && greekHolidays[year].includes(dateStr)) {
                        dayElem.classList.add("holiday");
                    }
                },
                onChange: function(selectedDates, dateStr, instance) {
                    calculateDays(instance.element, index);
                }
            });
        }
    });
}
        function printLeaves() {
            window.print();
        }

        function generateReport() {
            let totalDays = 0, regularDays = 0, sickDays = 0, parentalDays = 0, parentalHours = 0, educationalDays = 0, specialDays = 0, bloodDonationDays = 0, dayOffDays = 0, otherDays = 0;

            const filteredLeaves = leaves.filter(leave => new Date(leave.from_date).getFullYear() === selectedYear);
            filteredLeaves.forEach(leave => {
                if (leave.saved) {
                    totalDays += leave.days;
                    if (leave.regular) regularDays += leave.days;
                    if (leave.sick) sickDays += leave.days;
                    if (leave.parental) {
                        parentalDays += leave.days;
                        parentalHours += leave.parental_hours || 0;
                    }
                    if (leave.educational) educationalDays += leave.days;
                    if (leave.special) specialDays += leave.days;
                    if (leave.blood_donation) bloodDonationDays += leave.days;
                    if (leave.day_off) dayOffDays += leave.days;
                    if (leave.other) otherDays += leave.days;
                }
            });

            document.getElementById("reportYear").textContent = selectedYear;
            document.getElementById("totalLeaveDays").textContent = totalDays;
            document.getElementById("regularDays").textContent = regularDays;
            document.getElementById("sickDays").textContent = sickDays;
            document.getElementById("parentalDays").textContent = parentalDays;
            document.getElementById("parentalHours").textContent = parentalHours;
            document.getElementById("educationalDays").textContent = educationalDays;
            document.getElementById("specialDays").textContent = specialDays;
            document.getElementById("bloodDonationDays").textContent = bloodDonationDays;
            document.getElementById("dayOffDays").textContent = dayOffDays;
            document.getElementById("otherDays").textContent = otherDays;

            document.getElementById("leaveReport").style.display = "block";
        }
    </script>
</body>
</html>
